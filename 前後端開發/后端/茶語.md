# ä½µç™¼éšŠåˆ—

## æœ‰ç•Œé˜»å¡éšŠåˆ— Â· æ•¸çµ„ (ArrayBlockingQueue)

### å®šç¾©

- å¯¦ç¾ï¼šæ•¸çµ„
- é–ï¼šæ·»åŠ å’Œåˆªé™¤ä½¿ç”¨åŒä¸€æŠŠé–

```java
public static void main(String[] args)
{
    BlockingQueue<String> queue = new ArrayBlockingQueue<>(5);//å®¹é‡ä¸º5çš„æœ‰ç•Œé˜Ÿåˆ—
    Random rand = new Random();

    Thread producer = new Thread(() ->
    {
        int count = 0;
        try
        {
            while (true)
            {
                queue.put(++count);  // é˜»å¡å¼æ’å…¥
                print(queue.size()); // å¯¦ç¾çš„å¯è¦–åŒ–çš„å¤§å°
                Thread.sleep(rand.nextInt(200));
            }
        } catch (InterruptedException e)
        {
            Thread.currentThread().interrupt();
        }
    });
    Thread consumer = new Thread(() ->
    {
        try
        {
            while (true)
            {
                String item = queue.take(); // é˜»å¡å¼å–å‡º
                print(queue.size());
                Thread.sleep(rand.nextInt(200));
            }
        } catch (InterruptedException e)
        {
            Thread.currentThread().interrupt();
        }
    });
    producer.start();
    consumer.start();
}
```
> ## åŸ·è¡Œçµæœ
> åœ¨åŸ·è¡Œç·’ä¸­ï¼Œç”Ÿç”¢è€…æ¶ˆè²»è€…äº’ç›¸é‹è¡Œï¼Œå¾æ¦‚ç‡ä¸Šçœ‹ç›¸ç­‰ï¼Œæœ‰å¦‚ä¸‹ä¸‰å€‹ç©©å®šç‹€æ…‹äº’ç›¸è½‰æ›
> ### 1. å¤§éƒ¨åˆ†ç©ºçš„æ™‚å€™
> 
> ```
> 1 0 1 0 1 0 1 0 1 0...
> ```
> - åœ¨é‹è¡Œçš„æ™‚å€™æ¶ˆè²»è€…éš¨æ©Ÿå‡ºçš„æ™‚é–“è¼ƒçŸ­ï¼ŒéšŠåˆ—å¹¾ä¹ç‚ºç©ºï¼Œè¡¹è¦ç”Ÿç”¢ä¸€å€‹ï¼Œå°±æ¶ˆè²»æ‰ã€‚
> - éšŠåˆ—çš„ä½œç”¨åœ¨æ–¼åœ¨ **éšŠåˆ—ç‚ºç©º** çš„æ™‚å€™é˜»å¡ **æ¶ˆè²»è€…** åŸ·è¡Œç·’
> 
> ### 2. å¤§éƒ¨åˆ†æ»¿çš„æ™‚å€™
> 
> ```
> 4 5 4 5 4 5 4 5 4 5...
> ```
> - åœ¨é‹è¡Œçš„æ™‚å€™ç”Ÿç”¢è€…éš¨æ©Ÿå‡ºçš„æ™‚é–“è¼ƒçŸ­ï¼ŒéšŠåˆ—å¹¾ä¹ç‚ºæ»¿ï¼Œè¡¹è¦æ¶ˆè²»ä¸€å€‹ï¼Œå°±ç”Ÿç”¢å‡ºä¾†
> - éšŠåˆ—çš„ä½œç”¨åœ¨æ–¼åœ¨ **éšŠåˆ—ç‚ºæ»¿** çš„æ™‚å€™é˜»å¡ **ç”Ÿç”¢è€…** åŸ·è¡Œç·’
> - 
> ### 3. ä¸­é–“ç‹€æ…‹
> 
> ```
> 2 3 4 3 4 3 2 3 2 1...
> ```
> - ç”Ÿç”¢è€…å’Œæ¶ˆè²»è€…çš„åºåˆ—ä¿æŒå¹³è¡¡
> - éšŠåˆ—ä¸¦æ²’æœ‰é˜»å¡ä»€éº¼





## æœ‰ç•Œé˜»å¡éšŠåˆ— Â· éˆè¡¨ (LinkedBlockingQueue)

### å®šç¾©
- å¯¦ç¾ï¼šéˆè¡¨
- é–ï¼šæ·»åŠ å’Œåˆªé™¤ä½¿ç”¨ç¨ç«‹çš„é–

### ç‰¹é»

- ä¸è¨­ç½®å¤§å°çš„æ™‚å€™æ˜¯`Integer.MAX_VALUE`å¹¾ä¹ç­‰æ–¼ç„¡çª®





## åŒæ­¥æ¡æ‰‹éšŠåˆ— (SynchronousQueue)

```java
public static void main(String[] args)
{
    SynchronousQueue<String> queue = new SynchronousQueue<>();
    Random rand = new Random();
    Thread producer = new Thread(() ->
    {
        int count = 0;
        try
        {
            while (true)
            {
                String data = String.valueOf(++count);
                System.out.println("+ ");
                queue.put(data);  // é˜»å¡å¼æ’å…¥
                System.out.println("æ”¾å…¥" + data);
                System.out.println("æ”¾å…¥å¤§å°ï¼š"+queue.size());
                Thread.sleep(rand.nextInt(300)); // æ¨¡æ“¬éš¨æ©Ÿç”Ÿç”¢é€Ÿåº¦
            }
        } catch (InterruptedException e)
        {
            Thread.currentThread().interrupt();
        }
    });
    Thread consumer = new Thread(() ->
    {
        try
        {
            while (true)
            {
                System.out.println("- ");
                String item = queue.take();  // é˜»å¡å¼å–å‡º
                System.out.println("å–å‡º" + item+" ");
                System.out.println("å–å‡ºå¤§å°ï¼š"+queue.size());
                Thread.sleep(rand.nextInt(300)); // æ¨¡æ“¬éš¨æ©Ÿæ¶ˆè²»é€Ÿåº¦
            }
        } catch (InterruptedException e)
        {
            Thread.currentThread().interrupt();
        }
    });
    producer.start();
    consumer.start();
}
```



## ç„¡é–éšŠåˆ—


### æ™®é€šéšŠåˆ—
> 
> ç†è«–æ˜¯`2000`ï¼Œä½†æ˜¯å› ç‚ºæ’å…¥å‡½æ•¸ä¸æ˜¯åŸå­æ€§çš„ï¼Œå°è‡´æ¯ä¸€å€‹çµæœéƒ½ä¸ä¸€æ¨£ä¸”å¤§æ¦‚ç‡å°æ–¼`2000`
> 1. ç¯€é»è¦†è“‹
> 2. æŒ‡æ¨™ä¸Ÿå¤±
> 

```java
public static void main(String[] args) throws InterruptedException
{
    Queue<Integer> queue = new LinkedList<>();
    // å…©å€‹ç·šç¨‹åŒæ™‚å‘éšŠåˆ—æ·»åŠ å…ƒç´ ï¼ˆéç·šç¨‹å®‰å…¨ï¼‰
    Runnable producer = () ->
    {
        for (int i = 0; i < 1000; i++) queue.offer(i);
    };
    Thread t1 = new Thread(producer);
    Thread t2 = new Thread(producer);
    t1.start();
    t2.start();
    t1.join();
    t2.join();
    System.out.println("éšŠåˆ—å¤§å°: " + queue.size()); // ç†è«–æ‡‰è©²æ˜¯ 2000ï¼Œä½†çµæœæœƒå°æ–¼ä¸”ä¸ç©©å®š
}
```









# é–

ReentrantLock 





# æ‚ªå±‘å›æ”¶ â™»ï¸

## å¯ä»¥æœ€ç‚ºå›æ”¶çš„ç‰©ä»¶

1. è™›æ“¬æ©Ÿå †ç–Šæˆ–æœ¬åœ°å‡½æ•¸æ£§



----


# æ•£åˆ—è¡¨ 

## ç‰¹é»
ç·šç¨‹ä¸å®‰å…¨

## ğŸ—ï¸ çµæ§‹

æ¡¶çš„æ•¸çµ„ä¸‹æ›çš„è¦éº¼æ˜¯éˆè¡¨ï¼Œè¦éº¼æ˜¯ç´…é»‘æ¨¹
```
â–¡â–¡â–¡â–¡â–¡â–¡â–¡â–¡â–¡â–¡â–¡â–¡â–¡â–¡â–¡â–¡â–¡â–¡
  â†“    â†“    â†“ 
  â–¡   null   â–¡
  â–¡        â†™  â†˜
  â–¡       â–¡    â–¡
  â–¡      â†™â†˜   â†™â†˜
 null   â–¡  â–¡  â–¡  â–¡
```
JDK8é–‹å§‹ä½¿ç”¨ç´…é»‘æ¨¹ï¼šåœ¨ä¹‹å‰ç‰ˆæœ¬é‡Œä½¿ç”¨æ•¸çµ„åŠ éˆè¡¨ï¼Œä½†æ•¸æ“šä¸å‡å‹»çš„æ™‚å€™æœƒå°è‡´é•·åº¦éé•·

## æµç¨‹

### æŸ¥è©¢ï¼š`get()`
> ### 1. è¨ˆç®—é›œæ¹Šå€¼
> 
> ```javascript
> h = (key == null) ? 0 : key.hashCode();
> h = h^(h>>>16)//é«˜ä½ä½ä½æ··åˆé‹ç®—æé«˜éš¨æ©Ÿæ€§
> ```
> 
> ### 2. ç²å¾—ä¸‹æ¨™
> åœ¨å¤§å°ç‚º`2^n` çš„æ™‚å€™
> - è¨ˆç®—æ¡¶çš„æ™‚å€™çš„`hash & (length-1)` æ˜¯å’Œ `hash % length`ç­‰åƒ¹çš„ï¼Œä½é‹ç®—æ¯”æ±‚é¤˜æ•¸æ•ˆç‡æ›´é«˜ã€‚
> - æ­¤æ™‚`length-1`å°±å…¨ç‚º1ï¼Œå’Œä»–åšæŒ‰ä½èˆ‡å°±æ˜¯å–ä½ä½ï¼Œå¦‚æœä¸æ˜¯å…¨1ï¼Œåœ¨0çš„é‚£äº›ä½ç½®ä¸ŠæŒ‰ä½èˆ‡ç„¡æ³•å€åˆ†é–‹
> 
> ### 3. ä¾æ¬¡åˆ¤æ–· é¦–ç¯€é» å’Œ é ·ç¯€é»
> - é¦–ç¯€é»ç‚ºnullï¼Œå‰‡æ‰¾ä¸åˆ°
> - é¦–ç¯€é»åŒ¹é…ï¼Œå‰‡è¿”å›
> - é¦–ç¯€é»ä¸åŒ¹é…ï¼ŒåŒæ¨£çš„æ–¹æ³•åˆ¤æ–·ä¸‹ä¸€å€‹ç¯€é»
> 
> ### 4. ä»ç„¶ä¸åŒ¹é…ï¼Œå‰‡åˆ¤æ–·ç¯€é»é¡å‹
> - å¦‚æœæ˜¯ç´…é»‘æ¨¹ï¼Œä½¿ç”¨O(log2)æŸ¥æ‰¾
> - å¦‚æœæ˜¯éˆè¡¨ï¼Œä½¿ç”¨O(n) æŸ¥æ‰¾



### æ·»åŠ ï¼š`put()`
> ### 1. åˆå§‹åŒ–æ“´å®¹
> - `capacity` å®¹é‡ï¼šæ•¸çµ„é•·åº¦ï¼Œé»˜èª`16`
> - `loadFactor` è² è¼‰å› å­ï¼šé»˜èª`0.75`
> - `threshold` é–¾å€¼ï¼š`é–¾å€¼=å®¹é‡*åŠ è¼‰å› å­`ï¼Œé»˜èª`12`
> 
> ### 2. è¨ˆç®—é›œæ¹Šå€¼ï¼Œç²å¾—ä¸‹æ¨™
> åŒä¸Š
> 
> ### 3. åˆ¤æ–·é¦–ç¯€é»
> - é¦–ç¯€é»ç‚ºnullï¼Œç›´æ¥æ’å…¥
> - é¦–ç¯€é»éµç›¸åŒï¼Œç›´æ¥è¦†è“‹
> - é¦–ç¯€é»ä¸ç›¸åŒï¼Œåˆ¤æ–·ç¯€é»é¡å‹ï¼Œæ’å…¥éˆè¡¨æˆ–è€…æ¨¹ä¸­
> 
> ### 4. æ•´ç†
> - éˆè¡¨é•·åº¦â‰¥8ï¼Œå‰‡è½‰åŒ–ç‚ºç´…é»‘æ¨¹
> - éµå€¼å°æ•¸é‡å¤§æ–¼é–¾å€¼å‰‡æ“´å®¹


# ç·©å­˜ç•°å¸¸

## ğŸ—¡ï¸ ç·©å­˜ç©¿é€

### å®šç¾©

èŠ±æœŸéæ¿¾å™¨

## â„ï¸ ç·©å­˜é›ªå´©

## 

----
# å…§å­˜ç•°å¸¸

## ğŸ’¥ è¨˜æ†¶é«”æº¢å‡º


## è¨˜æ†¶é«”æ´©éœ²
### å®šç¾©
> åœ¨ç”³è«‹çš„æ™‚å€™ï¼Œæ²’æœ‰è¶³å¤ ç©ºé–“ä½¿ç”¨ï¼Œ`out of memory`

### å ´æ™¯å’Œè§£æ±º






å…§å­˜æ´©éœ²ï¼šå‹•æ…‹åˆ†é…ä¹‹å¾Œæ²’æœ‰æ­£ç¢ºé‡‹æ”¾ä¸åœ¨ä½¿ç”¨çš„å…§å®¹ï¼Œå°è‡´ç„¡æ³•è¢«ä½¿ç”¨ã€‚é•·æœŸæœƒå°è‡´å…§å­˜è€—ç›¡

## å…¸å‹å ´æ™¯


# æ­»é–



